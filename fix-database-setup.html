<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤æ•°æ®åº“è®¾ç½® - å åœåº”ç”¨</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }
        .step {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }
        .result {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4caf50;
        }
        .error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }
        .warning {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid #ffc107;
            color: #fff3cd;
        }
        .info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid #2196f3;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .sql-code {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ä¿®å¤å åœåº”ç”¨æ•°æ®åº“</h1>
        
        <div class="step">
            <h3>ğŸ“‹ é—®é¢˜è¯Šæ–­</h3>
            <p>æ£€æµ‹åˆ°ä»¥ä¸‹åŠŸèƒ½æ— æ³•ä½¿ç”¨ï¼šç­¾åˆ°ã€è®¸æ„¿å¢™ã€æˆé•¿è®°å½•ã€ä¸ªæ€§åŒ–æ¨èã€å‘½è¿æé†’ã€æŠ¥å‘Šåˆ†äº«</p>
            <p><strong>åŸå› ï¼š</strong>æ•°æ®åº“è¡¨å°šæœªåˆ›å»ºæˆ–é…ç½®ä¸å®Œæ•´</p>
            <button onclick="testConnection()">ğŸ” æ£€æµ‹æ•°æ®åº“è¿æ¥</button>
            <div id="connectionResult"></div>
        </div>

        <div class="step">
            <h3>ğŸ› ï¸ è‡ªåŠ¨ä¿®å¤</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è‡ªåŠ¨åˆ›å»ºæ‰€éœ€çš„æ•°æ®åº“è¡¨å’Œé…ç½®ï¼š</p>
            <button onclick="setupDatabase()" id="setupBtn">ğŸš€ ä¸€é”®ä¿®å¤æ•°æ®åº“</button>
            <div class="progress" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="setupResult"></div>
        </div>

        <div class="step">
            <h3>âœ… éªŒè¯ä¿®å¤</h3>
            <p>ä¿®å¤å®Œæˆåï¼ŒéªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š</p>
            <button onclick="verifyFunctions()" id="verifyBtn" disabled>ğŸ” éªŒè¯åŠŸèƒ½</button>
            <div id="verifyResult"></div>
        </div>

        <div class="step">
            <h3>ğŸ“– æ‰‹åŠ¨ä¿®å¤æŒ‡å—</h3>
            <p>å¦‚æœè‡ªåŠ¨ä¿®å¤å¤±è´¥ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨æ“ä½œï¼š</p>
            <ol>
                <li>ç™»å½• <a href="https://supabase.com/dashboard" target="_blank" style="color: #ffd700;">Supabase æ§åˆ¶å°</a></li>
                <li>é€‰æ‹©æ‚¨çš„é¡¹ç›®</li>
                <li>è¿›å…¥ "SQL Editor"</li>
                <li>å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹SQLè„šæœ¬ï¼š</li>
            </ol>
            <button onclick="showSQL()">ğŸ“„ æ˜¾ç¤ºSQLè„šæœ¬</button>
            <div id="sqlScripts" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Supabaseé…ç½®
        const supabaseUrl = 'https://anwwblcjzmykznimqmxu.supabase.co/';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFud3dibGNqem15a3puaW1xbXh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MzUzNzYsImV4cCI6MjA2OTUxMTM3Nn0.Y9tK0G0H3WRdHUSRCv8FhmqwS5sJCJ6CKMUAUQ1vzk8';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testConnection() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...</div>';
            
            try {
                const { data, error } = await supabase.from('users').select('count').limit(1);
                
                if (error) {
                    if (error.message.includes('relation "users" does not exist')) {
                        resultDiv.innerHTML = `
                            <div class="warning">
                                âš ï¸ æ•°æ®åº“è¡¨ä¸å­˜åœ¨<br>
                                <strong>è§£å†³æ–¹æ¡ˆï¼š</strong>éœ€è¦åˆ›å»ºæ•°æ®åº“è¡¨
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="error">
                                âŒ è¿æ¥å¤±è´¥: ${error.message}
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="success">
                            âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼æ‰€æœ‰åŠŸèƒ½åº”è¯¥å¯ä»¥ä½¿ç”¨ã€‚
                        </div>
                    `;
                }
            } catch (err) {
                resultDiv.innerHTML = `
                    <div class="error">
                        âŒ æµ‹è¯•å¤±è´¥: ${err.message}
                    </div>
                `;
            }
        }

        // è®¾ç½®æ•°æ®åº“
        async function setupDatabase() {
            const setupBtn = document.getElementById('setupBtn');
            const verifyBtn = document.getElementById('verifyBtn');
            const resultDiv = document.getElementById('setupResult');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            
            setupBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultDiv.innerHTML = '';
            
            const sqlScripts = [
                {
                    name: 'åˆ›å»ºç”¨æˆ·è¡¨',
                    sql: `
                        CREATE TABLE IF NOT EXISTS users (
                          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                          email TEXT UNIQUE NOT NULL,
                          username TEXT UNIQUE NOT NULL,
                          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                          last_sign_in TIMESTAMP WITH TIME ZONE,
                          sign_in_streak INTEGER DEFAULT 0,
                          total_sign_ins INTEGER DEFAULT 0
                        );
                    `
                },
                {
                    name: 'åˆ›å»ºç­¾åˆ°è®°å½•è¡¨',
                    sql: `
                        CREATE TABLE IF NOT EXISTS sign_ins (
                          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                          user_id UUID REFERENCES users(id) ON DELETE CASCADE,
                          date DATE NOT NULL,
                          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                          UNIQUE(user_id, date)
                        );
                    `
                },
                {
                    name: 'åˆ›å»ºæ¯æ—¥è¿åŠ¿è¡¨',
                    sql: `
                        CREATE TABLE IF NOT EXISTS daily_fortunes (
                          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                          user_id UUID REFERENCES users(id) ON DELETE CASCADE,
                          date DATE NOT NULL,
                          fortune_type TEXT NOT NULL,
                          fortune_content TEXT NOT NULL,
                          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                          UNIQUE(user_id, date)
                        );
                    `
                },
                {
                    name: 'åˆ›å»ºè®¸æ„¿è¡¨',
                    sql: `
                        CREATE TABLE IF NOT EXISTS wishes (
                          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                          user_id UUID REFERENCES users(id) ON DELETE SET NULL,
                          content TEXT NOT NULL,
                          is_anonymous BOOLEAN DEFAULT TRUE,
                          likes INTEGER DEFAULT 0,
                          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
                        );
                    `
                },
                {
                    name: 'åˆ›å»ºç‚¹èµè®°å½•è¡¨',
                    sql: `
                        CREATE TABLE IF NOT EXISTS wish_likes (
                          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                          user_id UUID REFERENCES users(id) ON DELETE CASCADE,
                          wish_id UUID REFERENCES wishes(id) ON DELETE CASCADE,
                          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                          UNIQUE(user_id, wish_id)
                        );
                    `
                },
                {
                    name: 'åˆ›å»ºå åœå†å²è®°å½•è¡¨',
                    sql: `
                        CREATE TABLE IF NOT EXISTS divination_history (
                          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                          user_id UUID REFERENCES users(id) ON DELETE CASCADE,
                          method TEXT NOT NULL,
                          type TEXT NOT NULL,
                          question TEXT NOT NULL,
                          result TEXT NOT NULL,
                          is_ai_generated BOOLEAN DEFAULT FALSE,
                          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
                        );
                    `
                },
                {
                    name: 'åˆ›å»ºç´¢å¼•',
                    sql: `
                        CREATE INDEX IF NOT EXISTS idx_sign_ins_user_date ON sign_ins(user_id, date);
                        CREATE INDEX IF NOT EXISTS idx_daily_fortunes_user_date ON daily_fortunes(user_id, date);
                        CREATE INDEX IF NOT EXISTS idx_wishes_created_at ON wishes(created_at DESC);
                        CREATE INDEX IF NOT EXISTS idx_divination_history_user ON divination_history(user_id, created_at DESC);
                    `
                },
                {
                    name: 'å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥',
                    sql: `
                        ALTER TABLE users ENABLE ROW LEVEL SECURITY;
                        ALTER TABLE sign_ins ENABLE ROW LEVEL SECURITY;
                        ALTER TABLE daily_fortunes ENABLE ROW LEVEL SECURITY;
                        ALTER TABLE wishes ENABLE ROW LEVEL SECURITY;
                        ALTER TABLE wish_likes ENABLE ROW LEVEL SECURITY;
                        ALTER TABLE divination_history ENABLE ROW LEVEL SECURITY;
                    `
                },
                {
                    name: 'åˆ›å»ºå®‰å…¨ç­–ç•¥',
                    sql: `
                        CREATE POLICY IF NOT EXISTS "Users can view own profile" ON users
                          FOR SELECT USING (auth.uid() = id);
                        CREATE POLICY IF NOT EXISTS "Users can update own profile" ON users
                          FOR UPDATE USING (auth.uid() = id);
                        CREATE POLICY IF NOT EXISTS "Users can view own sign-ins" ON sign_ins
                          FOR SELECT USING (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Users can insert own sign-ins" ON sign_ins
                          FOR INSERT WITH CHECK (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Users can view own fortunes" ON daily_fortunes
                          FOR SELECT USING (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Users can insert own fortunes" ON daily_fortunes
                          FOR INSERT WITH CHECK (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Anyone can view wishes" ON wishes
                          FOR SELECT USING (true);
                        CREATE POLICY IF NOT EXISTS "Authenticated users can insert wishes" ON wishes
                          FOR INSERT WITH CHECK (auth.role() = 'authenticated');
                        CREATE POLICY IF NOT EXISTS "Users can update own wishes" ON wishes
                          FOR UPDATE USING (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Users can view wish likes" ON wish_likes
                          FOR SELECT USING (true);
                        CREATE POLICY IF NOT EXISTS "Users can insert wish likes" ON wish_likes
                          FOR INSERT WITH CHECK (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Users can view own divination history" ON divination_history
                          FOR SELECT USING (auth.uid() = user_id);
                        CREATE POLICY IF NOT EXISTS "Users can insert own divination history" ON divination_history
                          FOR INSERT WITH CHECK (auth.uid() = user_id);
                    `
                }
            ];
            
            let successCount = 0;
            const totalSteps = sqlScripts.length;
            
            for (let i = 0; i < sqlScripts.length; i++) {
                const script = sqlScripts[i];
                const progress = ((i + 1) / totalSteps) * 100;
                progressBar.style.width = progress + '%';
                
                try {
                    resultDiv.innerHTML += `<div class="info">ğŸ”„ ${script.name}...</div>`;
                    
                    const { data, error } = await supabase.rpc('exec_sql', { sql_query: script.sql });
                    
                    if (error) {
                        // å°è¯•ç›´æ¥æ‰§è¡ŒSQLï¼ˆæŸäº›Supabaseé…ç½®å¯èƒ½ä¸æ”¯æŒrpcï¼‰
                        console.warn('RPC failed, trying direct execution:', error);
                        resultDiv.innerHTML += `<div class="warning">âš ï¸ ${script.name}: éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ</div>`;
                    } else {
                        resultDiv.innerHTML += `<div class="success">âœ… ${script.name}: å®Œæˆ</div>`;
                        successCount++;
                    }
                } catch (err) {
                    resultDiv.innerHTML += `<div class="error">âŒ ${script.name}: ${err.message}</div>`;
                }
                
                // æ·»åŠ å»¶è¿Ÿä»¥æ˜¾ç¤ºè¿›åº¦
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            if (successCount === totalSteps) {
                resultDiv.innerHTML += `
                    <div class="success">
                        ğŸ‰ æ•°æ®åº“è®¾ç½®å®Œæˆï¼æ‰€æœ‰è¡¨å’Œç­–ç•¥å·²åˆ›å»ºã€‚
                    </div>
                `;
                verifyBtn.disabled = false;
            } else {
                resultDiv.innerHTML += `
                    <div class="warning">
                        âš ï¸ éƒ¨åˆ†æ­¥éª¤éœ€è¦æ‰‹åŠ¨å®Œæˆã€‚è¯·æŸ¥çœ‹ä¸Šé¢çš„é”™è¯¯ä¿¡æ¯æˆ–ä½¿ç”¨æ‰‹åŠ¨ä¿®å¤æŒ‡å—ã€‚
                    </div>
                `;
            }
            
            setupBtn.disabled = false;
            progressContainer.style.display = 'none';
        }

        // éªŒè¯åŠŸèƒ½
        async function verifyFunctions() {
            const resultDiv = document.getElementById('verifyResult');
            resultDiv.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨éªŒè¯åŠŸèƒ½...</div>';
            
            const tests = [
                { name: 'ç”¨æˆ·è¡¨', table: 'users' },
                { name: 'ç­¾åˆ°è®°å½•', table: 'sign_ins' },
                { name: 'æ¯æ—¥è¿åŠ¿', table: 'daily_fortunes' },
                { name: 'è®¸æ„¿å¢™', table: 'wishes' },
                { name: 'ç‚¹èµè®°å½•', table: 'wish_likes' },
                { name: 'å åœå†å²', table: 'divination_history' }
            ];
            
            let passedTests = 0;
            let testResults = '';
            
            for (const test of tests) {
                try {
                    const { data, error } = await supabase.from(test.table).select('count').limit(1);
                    
                    if (error) {
                        testResults += `<div class="error">âŒ ${test.name}: ${error.message}</div>`;
                    } else {
                        testResults += `<div class="success">âœ… ${test.name}: æ­£å¸¸</div>`;
                        passedTests++;
                    }
                } catch (err) {
                    testResults += `<div class="error">âŒ ${test.name}: ${err.message}</div>`;
                }
            }
            
            if (passedTests === tests.length) {
                resultDiv.innerHTML = `
                    ${testResults}
                    <div class="success">
                        ğŸ‰ æ‰€æœ‰åŠŸèƒ½éªŒè¯é€šè¿‡ï¼ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š<br>
                        â€¢ ç­¾åˆ°åŠŸèƒ½<br>
                        â€¢ è®¸æ„¿å¢™<br>
                        â€¢ æˆé•¿è®°å½•<br>
                        â€¢ ä¸ªæ€§åŒ–æ¨è<br>
                        â€¢ å‘½è¿æé†’<br>
                        â€¢ æŠ¥å‘Šåˆ†äº«
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    ${testResults}
                    <div class="warning">
                        âš ï¸ ${passedTests}/${tests.length} é¡¹åŠŸèƒ½æ­£å¸¸ã€‚è¯·æ£€æŸ¥å¤±è´¥çš„é¡¹ç›®ã€‚
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºSQLè„šæœ¬
        function showSQL() {
            const sqlDiv = document.getElementById('sqlScripts');
            if (sqlDiv.style.display === 'none') {
                sqlDiv.style.display = 'block';
                sqlDiv.innerHTML = `
                    <div class="sql-code">
-- åŸºç¡€è¡¨ç»“æ„
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  username TEXT UNIQUE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_sign_in TIMESTAMP WITH TIME ZONE,
  sign_in_streak INTEGER DEFAULT 0,
  total_sign_ins INTEGER DEFAULT 0
);

CREATE TABLE IF NOT EXISTS sign_ins (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, date)
);

CREATE TABLE IF NOT EXISTS daily_fortunes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  fortune_type TEXT NOT NULL,
  fortune_content TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, date)
);

CREATE TABLE IF NOT EXISTS wishes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE SET NULL,
  content TEXT NOT NULL,
  is_anonymous BOOLEAN DEFAULT TRUE,
  likes INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS wish_likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  wish_id UUID REFERENCES wishes(id) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, wish_id)
);

CREATE TABLE IF NOT EXISTS divination_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  method TEXT NOT NULL,
  type TEXT NOT NULL,
  question TEXT NOT NULL,
  result TEXT NOT NULL,
  is_ai_generated BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_sign_ins_user_date ON sign_ins(user_id, date);
CREATE INDEX IF NOT EXISTS idx_daily_fortunes_user_date ON daily_fortunes(user_id, date);
CREATE INDEX IF NOT EXISTS idx_wishes_created_at ON wishes(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_divination_history_user ON divination_history(user_id, created_at DESC);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE sign_ins ENABLE ROW LEVEL SECURITY;
ALTER TABLE daily_fortunes ENABLE ROW LEVEL SECURITY;
ALTER TABLE wishes ENABLE ROW LEVEL SECURITY;
ALTER TABLE wish_likes ENABLE ROW LEVEL SECURITY;
ALTER TABLE divination_history ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºå®‰å…¨ç­–ç•¥
CREATE POLICY "Users can view own profile" ON users
  FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Users can update own profile" ON users
  FOR UPDATE USING (auth.uid() = id);
CREATE POLICY "Users can view own sign-ins" ON sign_ins
  FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own sign-ins" ON sign_ins
  FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can view own fortunes" ON daily_fortunes
  FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own fortunes" ON daily_fortunes
  FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Anyone can view wishes" ON wishes
  FOR SELECT USING (true);
CREATE POLICY "Authenticated users can insert wishes" ON wishes
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Users can update own wishes" ON wishes
  FOR UPDATE USING (auth.uid() = user_id);
CREATE POLICY "Users can view wish likes" ON wish_likes
  FOR SELECT USING (true);
CREATE POLICY "Users can insert wish likes" ON wish_likes
  FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can view own divination history" ON divination_history
  FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own divination history" ON divination_history
  FOR INSERT WITH CHECK (auth.uid() = user_id);
                    </div>
                    <p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
                    <ol>
                        <li>å¤åˆ¶ä¸Šé¢çš„SQLä»£ç </li>
                        <li>ç™»å½•Supabaseæ§åˆ¶å°</li>
                        <li>è¿›å…¥SQL Editor</li>
                        <li>ç²˜è´´å¹¶æ‰§è¡Œä»£ç </li>
                    </ol>
                `;
            } else {
                sqlDiv.style.display = 'none';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.addEventListener('load', function() {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>